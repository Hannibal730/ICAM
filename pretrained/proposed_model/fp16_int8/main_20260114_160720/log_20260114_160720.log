2026-01-14 16:07:20,456 - INFO - 로그 파일이 'log/Sewer-TAPNEW/main_20260114_160720/log_20260114_160720.log'에 저장됩니다.
2026-01-14 16:07:20,461 - INFO - ==================================================
2026-01-14 16:07:20,461 - INFO - config.yaml:
2026-01-14 16:07:20,461 - INFO - 
run:
  global_seed: 42
  cuda: true
  mode: inference
  pth_inference_dir: /home/cau/workspace/CHOI/sewer_binary_cls_v9/pretrained/proposed_model/original
  pth_best_name: best_model.pth
  evaluate_onnx: true
  only_inference: false
  use_fp16_inference: true
  show_log: true
  dataset:
    name: Sewer-TAPNEW
    type: image_folder
    train_split_ratio: 0.8
    paths:
      train_img_dir: /home/cau/workspace/data/Sewer/Sewer-ML/train
      valid_img_dir: /home/cau/workspace/data/Sewer/Sewer-ML/valid
      test_img_dir: /home/cau/workspace/data/Sewer/Sewer-ML/valid
      train_csv: /home/cau/workspace/data/Sewer/Sewer-ML/SewerML_Train.csv
      valid_csv: /home/cau/workspace/data/Sewer/Sewer-ML/SewerML_Val.csv
      test_csv: /home/cau/workspace/data/Sewer/Sewer-ML/SewerML_Val.csv
      img_folder: /home/cau/workspace/data/Sewer/Sewer-TAPNEW
  random_sampling_ratio:
    train: 1.0
    valid: 1.0
    test: 1.0
  num_workers: 16
training_main:
  epochs: 90
  batch_size: 16
  pre_trained: false
  optimizer: adamw
  lr: 0.001
  weight_decay: 0.0001
  loss_function: CrossEntropyLoss
  label_smoothing: 0.1
  scheduler: cosineannealinglr
  scheduler_params:
    T_max: 90
    eta_min: 0.0001
  best_model_criterion: val_loss
training_baseline:
  epochs: 10
  batch_size: 16
  pre_trained: false
  optimizer: adamw
  lr: 0.001
  weight_decay: 0.0001
  loss_function: CrossEntropyLoss
  label_smoothing: 0.1
  scheduler: cosineannealinglr
  scheduler_params:
    T_max: 10
    eta_min: 0.0001
  best_model_criterion: val_loss
finetuning_pruned:
  epochs: 80
  batch_size: 16
  optimizer: adamw
  lr: 0.001
  weight_decay: 0.0001
  loss_function: CrossEntropyLoss
  label_smoothing: 0.1
  scheduler: cosineannealinglr
  scheduler_params:
    T_max: 80
    eta_min: 0.0001
  best_model_criterion: val_loss
model:
  img_size: 224
  patch_size: 56
  stride: 56
  cnn_feature_extractor:
    name: efficientnet_b0_feat2
  featured_patch_dim: 24
  emb_dim: 24
  num_heads: 2
  num_decoder_layers: 2
  num_decoder_patches: 1
  adaptive_initial_query: true
  decoder_ff_ratio: 2
  dropout: 0.1
  positional_encoding: true
  res_attention: true
  save_attention: true
  num_plot_attention: 5
baseline:
  model_name: mobile_vit_xxs

2026-01-14 16:07:20,461 - INFO - ==================================================
2026-01-14 16:07:20,497 - WARNING - config.yaml에서 CUDA 사용이 활성화되었지만, 사용 가능한 CUDA 장치를 찾을 수 없습니다. CPU를 사용합니다.
2026-01-14 16:07:21,645 - INFO - CPU 사용을 시작합니다. (Device: Intel(R) Xeon(R) Gold 5416S)
2026-01-14 16:07:21,645 - INFO - 'Sewer-TAPNEW' 데이터 로드를 시작합니다 (Type: image_folder).
2026-01-14 16:07:21,645 - INFO - '/home/cau/workspace/data/Sewer/Sewer-TAPNEW' 경로의 데이터를 훈련/테스트셋으로 분할합니다.
2026-01-14 16:07:21,653 - INFO - 총 1692개 데이터를 훈련용 1353개, 테스트용 339개로 분할합니다 (split_seed=42).
2026-01-14 16:07:21,653 - INFO - 데이터셋 클래스: ['abnormal', 'normal'] (총 2개)
2026-01-14 16:07:21,654 - INFO - 훈련 데이터: 1353개, 검증 데이터: 339개, 테스트 데이터: 339개
2026-01-14 16:07:21,654 - INFO - 이미지 크기: 224, 패치 크기: 56, Stride: 56 -> 인코더 패치 수: 16개
2026-01-14 16:07:21,746 - INFO - ==================================================
2026-01-14 16:07:21,746 - INFO - 모델 파라미터 수: 31,371 개
2026-01-14 16:07:21,746 - INFO -   - Encoder (PatchConvEncoder):         19,402 개
2026-01-14 16:07:21,746 - INFO -     - conv_front (CNN Backbone):        19,090 개
2026-01-14 16:07:21,746 - INFO -     - 1x1_conv (Channel Proj):          0 개
2026-01-14 16:07:21,746 - INFO -     - patch_mixer (Depthwise Conv):     264 개
2026-01-14 16:07:21,746 - INFO -     - norm (LayerNorm):                 48 개
2026-01-14 16:07:21,746 - INFO -   - Decoder (Cross-Attention-based):    11,616 개
2026-01-14 16:07:21,746 - INFO -     - Embedding Layer (W_feat2emb):     600 개
2026-01-14 16:07:21,746 - INFO -     - Init Query Proj (W_Q_init):       600 개
2026-01-14 16:07:21,747 - INFO -     - Init Key Proj (W_K_init):         600 개
2026-01-14 16:07:21,747 - INFO -     - Init Value Proj (W_V_init):       600 개
2026-01-14 16:07:21,747 - INFO -     - Learnable Queries:                24 개
2026-01-14 16:07:21,747 - INFO -     - Decoder Layers (Cross-Attention): 8,592 개
2026-01-14 16:07:21,747 - INFO -     - Projection4Classifier:            600 개
2026-01-14 16:07:21,747 - INFO -   - Classifier (Projection MLP):        353 개
2026-01-14 16:07:21,747 - INFO - ==================================================
2026-01-14 16:07:21,747 - INFO - Inference 모드를 시작합니다.
2026-01-14 16:07:21,765 - INFO - '/home/cau/workspace/CHOI/sewer_binary_cls_v9/pretrained/proposed_model/original/best_model.pth' 가중치 로드 완료.
2026-01-14 16:07:21,842 - INFO - 연산량 (MACs): 0.0914 GMACs per sample
2026-01-14 16:07:21,842 - INFO - 연산량 (FLOPs): 0.1829 GFLOPs per sample
2026-01-14 16:07:21,842 - INFO - ==================================================
2026-01-14 16:07:21,842 - INFO - FP16 Inference (ONNX via onnxconverter-common)을 적용합니다.
2026-01-14 16:07:22,092 - INFO - onnxconverter-common을 사용하여 float16 변환을 수행합니다...
2026-01-14 16:07:22,129 - INFO - ONNX FP16 모델 저장 완료: log/Sewer-TAPNEW/main_20260114_160720/best_model_fp16.onnx
2026-01-14 16:07:22,327 - INFO - [Model Load] ONNX 모델(FP16) 로드 메모리: 905.49 MB (증가량: 9.93 MB)
2026-01-14 16:07:22,327 - INFO - ONNX 런타임의 샘플 당 Forward Pass 시간 측정을 시작합니다...
2026-01-14 16:07:22,845 - INFO - 샘플 당 평균 Forward Pass 시간 (ONNX, CPU): 3.10ms (std: 0.26ms)
2026-01-14 16:07:22,845 - INFO - 샘플 당 평균 FPS (ONNX, CPU): 323.69 FPS (std: 15.14) (1개 샘플 x 100회 반복)
2026-01-14 16:07:22,845 - INFO - [Inference Only] ONNX 런타임 추론 중 최대 CPU 메모리: 942.61 MB (순수 증가량: 37.12 MB)
2026-01-14 16:07:22,845 - INFO - [Total Process] ONNX 모델(FP16) 전체 메모리 사용량: 942.61 MB (전체 증가량: 47.05 MB)
2026-01-14 16:07:24,763 - INFO - [Inference (ONNX FP16)] | Test Acc (ONNX): 88.20%
2026-01-14 16:07:24,782 - INFO - [Metrics for 'abnormal' (ONNX)] | Precision: 0.8634 | Recall: 0.8854 | F1: 0.8742
2026-01-14 16:07:24,782 - INFO - [Metrics for 'normal' (ONNX)] | Precision: 0.8989 | Recall: 0.8791 | F1: 0.8889
2026-01-14 16:07:25,262 - INFO - ==================================================
2026-01-14 16:07:25,262 - INFO - 혼동 행렬 저장 완료. 'log/Sewer-TAPNEW/main_20260114_160720/confusion_matrix_20260114_160720.png' and 'log/Sewer-TAPNEW/main_20260114_160720/confusion_matrix_20260114_160720.pdf'
